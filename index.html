<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Mirror Park Mechanic â€” Quick Calculator</title>
<style>
  :root{
    --ink:#1e232a; --muted:#6b7280; --accent:#2563eb;
    --bg:#f5f7fb; --panel:#ffffff; --chip:#f2f4f8; --border:#dde3ee; --radius:16px; --shadow:0 10px 28px rgba(0,0,0,.08);
    --bg-dark:#0f141b; --panel-dark:#151b24; --chip-dark:#1b2330; --text-dark:#e7edf7; --border-dark:#273245;
  }
  [data-theme="dark"]{ --bg:var(--bg-dark); --panel:var(--panel-dark); --chip:var(--chip-dark); --ink:var(--text-dark); --muted:#9aa8bf; --border:var(--border-dark); }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial}
  h1,h2{margin:0}
  .container{max-width:1200px;margin:28px auto;padding:0 16px}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:16px}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{width:44px;height:44px;border-radius:12px;box-shadow:var(--shadow);display:grid;place-items:center;background:conic-gradient(from 0deg,#fff 0 35%,#9cc2ff 0 70%,#2563eb 0 100%)}
  .toolrow{display:flex;gap:10px;flex-wrap:wrap}
  .btn{padding:10px 14px;border:1px solid var(--border);border-radius:12px;background:var(--chip);color:inherit;font-weight:600;cursor:pointer}
  .btn.primary{background:linear-gradient(135deg,#2563eb,#3b82f6);color:#fff;border:none}
  .btn.ghost{background:transparent}
  .chip{padding:6px 10px;border-radius:999px;background:var(--chip);border:1px solid var(--border);color:var(--muted);font-weight:700;font-size:.85rem}
  .grid{display:grid;grid-template-columns:1fr 1fr .9fr;gap:16px}
  @media (max-width:980px){.grid{grid-template-columns:1fr}}
  .panel{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow)}
  .panel h2{padding:12px 14px;border-bottom:1px solid var(--border);font-size:1rem}
  .content{padding:12px}
  .row{display:grid;grid-template-columns:1fr auto auto;gap:10px;align-items:center;padding:10px;border-bottom:1px dashed var(--border)}
  .row:last-child{border-bottom:none}
  .muted{color:var(--muted);font-size:.9rem}
  .qty{display:grid;grid-template-columns:32px 40px 32px;gap:6px;align-items:center}
  .qty button{height:32px;border-radius:8px;border:1px solid var(--border);background:var(--chip);cursor:pointer}
  .qty input{width:40px;text-align:center;padding:6px;border:1px solid var(--border);border-radius:8px;background:transparent;color:inherit}
  .totals{display:flex;flex-direction:column;gap:10px}
  .tot{display:flex;justify-content:space-between;align-items:center}
  .big{font-weight:900;font-size:1.25rem}
  .footnote{padding:10px 12px;border-top:1px solid var(--border);font-size:.9rem;color:var(--muted)}
</style>
</head>
<body>
<div class="container">
  <header>
    <div class="brand">
      <div class="logo">ðŸ”§</div>
      <div>
        <h1>Mirror Park Mechanic â€” Calculator</h1>
        <div class="muted">Fast totals for common repairs. 1 window = 1 glass. Hood & trunk count as a door.</div>
      </div>
    </div>
    <div class="toolrow">
      <span class="chip">Autosaves</span>
      <button class="btn ghost" id="themeBtn" aria-pressed="false">ðŸŒ™ Dark</button>
      <button class="btn ghost" id="resetBtn">Clear</button>
      <button class="btn primary" id="shareBtn">Copy Summary</button>
    </div>
  </header>

  <div class="grid">
    <!-- Vehicle damage -->
    <section class="panel">
      <h2>Vehicle Damage</h2>
      <div class="content" id="damageList">
        <!-- rows injected -->
      </div>
      <div class="footnote">Tip: Doors includes <strong>hood</strong> and <strong>trunk</strong>.</div>
    </section>

    <!-- Materials / shop items -->
    <section class="panel">
      <h2>Materials & Shop Items</h2>
      <div class="content" id="materialList">
        <!-- rows injected -->
      </div>
    </section>

    <!-- Summary -->
    <aside class="panel">
      <h2>Summary</h2>
      <div class="content">
        <div id="cartLines" class="muted" style="margin-bottom:8px">No items yet.</div>
        <div class="totals">
          <div class="tot"><span>Subtotal</span><strong id="sub">$0.00</strong></div>
          <div class="tot big"><span>Total</span><strong id="tot">$0.00</strong></div>
        </div>
      </div>
      <div class="footnote" id="notes"></div>
    </aside>
  </div>
</div>

<script>
/* ------- Prices (from your sheet) ------- */
const PRICES = {
  Glass:40,
  Scrap:75,
  Aluminum:100,
  Steel:125,
  Door:75,
  Tires:25,
  'Repair Kit':600,
  'Motor Oil':500
};

/* ------- Mappings / UI rows ------- */
/* Vehicle damage rows are â€œlogical countsâ€ that map to billable materials */
const DAMAGE_ROWS = [
  { id:'win',  label:'Windows', unit:'each',     mapTo:'Glass',      price:PRICES.Glass },
  { id:'door', label:'Doors (incl. hood & trunk)', unit:'each', mapTo:'Door',       price:PRICES.Door },
  { id:'hood', label:'Hood',   unit:'each',      mapTo:'Door',       price:PRICES.Door },   // counts as Door
  { id:'trunk',label:'Trunk',  unit:'each',      mapTo:'Door',       price:PRICES.Door },   // counts as Door
  { id:'tire', label:'Tires',  unit:'each',      mapTo:'Tires',      price:PRICES.Tires },
];

/* Materials that can be sold directly (besides the above mappings) */
const MATERIAL_ROWS = [
  { id:'mat-scrap', label:'Scrap',      price:PRICES.Scrap },
  { id:'mat-al',    label:'Aluminum',   price:PRICES.Aluminum },
  { id:'mat-steel', label:'Steel',      price:PRICES.Steel },
  { id:'shop-rk',   label:'Repair Kit', price:PRICES['Repair Kit'] },
  { id:'shop-oil',  label:'Motor Oil',  price:PRICES['Motor Oil'] },
];

/* ------- State / persist ------- */
const KEY='mpm_calc_v1';
const state={ qty:{} };
try{ Object.assign(state, JSON.parse(localStorage.getItem(KEY)||'{}')); }catch{}
const save=()=>localStorage.setItem(KEY, JSON.stringify(state));

/* ------- Helpers ------- */
const currency = n => '$'+n.toFixed(2);
function setQty(id, val){ state.qty[id]=Math.max(0, Number(val)||0); save(); render(); }
function qty(id){ return Math.max(0, Number(state.qty[id]||0)); }

/* ------- Render rows ------- */
function rowHTML(r, current){
  return `<div class="row">
    <div><strong>${r.label}</strong>${r.unit?` <span class="muted">(${r.unit})</span>`:''}</div>
    <div class="muted">${currency(r.price)} each</div>
    <div class="qty">
      <button data-dec="${r.id}">âˆ’</button>
      <input inputmode="numeric" value="${current}"/>
      <button data-inc="${r.id}">+</button>
    </div>
  </div>`;
}
function bindQty(container){
  container.querySelectorAll('[data-inc]').forEach(b=>{
    b.addEventListener('click',()=>{ const id=b.getAttribute('data-inc'); setQty(id, qty(id)+1); });
  });
  container.querySelectorAll('[data-dec]').forEach(b=>{
    b.addEventListener('click',()=>{ const id=b.getAttribute('data-dec'); setQty(id, qty(id)-1); });
  });
  container.querySelectorAll('.row input').forEach((inp,i)=>{
    const id = (inp.closest('.row').querySelector('[data-inc]')||{}).getAttribute('data-inc') ||
               (inp.closest('.row').querySelector('[data-dec]')||{}).getAttribute('data-dec');
    inp.addEventListener('input',()=> setQty(id, inp.value));
  });
}

/* ------- Compute and render summary ------- */
function computeLines(){
  const lines = [];

  // From vehicle damage (logical â†’ billable)
  DAMAGE_ROWS.forEach(r=>{
    const q=qty(r.id); if(!q) return;
    lines.push({ name:r.mapTo||r.label, unit:r.price, qty:q });
  });

  // Materials sold directly
  MATERIAL_ROWS.forEach(r=>{
    const q=qty(r.id); if(!q) return;
    lines.push({ name:r.label, unit:r.price, qty:q });
  });

  // collapse same-name lines (e.g., Doors + Hood + Trunk â†’ Door)
  const merged={};
  lines.forEach(l=>{
    const k=l.name+'|'+l.unit;
    if(!merged[k]) merged[k]=Object.assign({}, l);
    else merged[k].qty += l.qty;
  });
  return Object.values(merged);
}

function render(){
  // left columns
  const dWrap=document.getElementById('damageList');
  dWrap.innerHTML = DAMAGE_ROWS.map(r=>rowHTML(r, qty(r.id))).join('');
  bindQty(dWrap);

  const mWrap=document.getElementById('materialList');
  mWrap.innerHTML = MATERIAL_ROWS.map(r=>rowHTML(r, qty(r.id))).join('');
  bindQty(mWrap);

  // summary
  const lines=computeLines();
  const cart=document.getElementById('cartLines');
  if(!lines.length){ cart.textContent='No items yet.'; }
  else{
    cart.innerHTML = lines.map(l=>`
      <div class="tot" style="margin:4px 0;">
        <span>${l.qty}Ã— ${l.name}</span>
        <strong>${currency(l.unit*l.qty)}</strong>
      </div>
    `).join('');
  }
  const sub = lines.reduce((s,l)=>s + l.unit*l.qty, 0);
  document.getElementById('sub').textContent = currency(sub);
  document.getElementById('tot').textContent = currency(sub);

  // footnotes
  document.getElementById('notes').textContent =
    'Pricing: Glass $40 â€¢ Scrap $75 â€¢ Aluminum $100 â€¢ Steel $125 â€¢ Door $75 â€¢ Tires $25 â€¢ Repair Kit $600 â€¢ Motor Oil $500';
}

/* ------- Actions ------- */
document.getElementById('resetBtn').addEventListener('click',()=>{
  if(!confirm('Clear all counts?')) return;
  state.qty={}; save(); render();
});
document.getElementById('shareBtn').addEventListener('click',()=>{
  const lines=computeLines();
  const total=lines.reduce((s,l)=>s+l.unit*l.qty,0);
  const text = lines.length
    ? lines.map(l=>`â€¢ ${l.qty}Ã— ${l.name} â€” ${currency(l.unit*l.qty)}`).join('\n') + `\nâ€”\nTotal: ${currency(total)}`
    : 'No items.';
  navigator.clipboard.writeText(text).then(()=>alert('Summary copied!'));
});

/* ------- Theme ------- */
const themeBtn=document.getElementById('themeBtn');
function applyTheme(t){ document.documentElement.setAttribute('data-theme',t); localStorage.setItem('mpm_theme',t); themeBtn.textContent = t==='dark'?'â˜€ï¸ Light':'ðŸŒ™ Dark'; themeBtn.setAttribute('aria-pressed', t==='dark'); }
applyTheme(localStorage.getItem('mpm_theme')||'light');
themeBtn.addEventListener('click',()=>applyTheme((localStorage.getItem('mpm_theme')||'light')==='light'?'dark':'light'));

/* ------- Init ------- */
render();
</script>
</body>
</html>
